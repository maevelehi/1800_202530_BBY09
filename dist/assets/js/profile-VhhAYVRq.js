import"./app-D-chPbn8.js";import{a as d,o as f,d as c,b as i,g,u as p}from"./site-navbar-CJE8ti2D.js";import"./site-footer-C7ShoOr8.js";import"./main-CDlNrMfc.js";function I(){f(d,async n=>{if(n)try{const e=c(i,"users",n.uid),t=await g(e);if(t.exists()){const o=t.data(),{name:r="",school:a="",group:s="",avatarUrl:l=""}=o;document.getElementById("nameInput").value=r,document.getElementById("schoolInput").value=a,document.getElementById("groupInput").value=s,l&&(document.getElementById("avatar").src=l)}else console.log("No such document!")}catch(e){console.error("Error getting user document:",e)}else console.log("No user is signed in")})}function y(){document.getElementById("personalInfoFields").disabled=!1,document.getElementById("editProfileBtn").textContent="Save Profile"}async function v(n,e,t,o,r){try{const a=c(i,"users",n);await p(a,{name:e,school:t,group:o,avatarUrl:r,lastUpdated:new Date}),console.log("User document successfully updated!")}catch(a){throw console.error("Error updating user document:",a),a}}async function E(){const n=d.currentUser;if(!n){alert("No user is signed in. Please log in first.");return}const e=document.getElementById("nameInput"),t=document.getElementById("schoolInput"),o=document.getElementById("groupInput"),r=document.getElementById("avatar"),a=e?.value.trim(),s=t?.value.trim(),l=o?.value,u=r.src;if(!a||!s){alert("Please fill in all required fields (Name and School).");return}try{await v(n.uid,a,s,l,u),document.getElementById("personalInfoFields").disabled=!0,document.getElementById("editProfileBtn").textContent="Edit Profile",alert("Profile updated successfully!")}catch(m){console.error("Error saving profile:",m),alert("Failed to save profile. Please try again.")}}function B(n){const e=n.target.files[0];if(e){const t=new FileReader;t.onload=function(o){document.getElementById("avatar").src=o.target.result},t.readAsDataURL(e)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing event listeners...");const n=document.getElementById("editProfileBtn");n&&n.addEventListener("click",function(){document.getElementById("personalInfoFields").disabled?y():E()});const e=document.getElementById("backButton");e&&e.addEventListener("click",function(){window.history.back()});const t=document.getElementById("avatarUpload"),o=document.getElementById("uploadAvatarBtn");o&&t&&(o.addEventListener("click",function(){t.click()}),t.addEventListener("change",B)),I()});
